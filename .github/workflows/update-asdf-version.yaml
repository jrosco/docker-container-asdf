name: Check ASDF Version Updates [bot_task]

on:
  pull_request:
    types: [ready_for_review]
  schedule:
    - cron: "45 09 * * *"  # Runs daily at 9:45 UTC / 20:45 AEDT
  workflow_dispatch:  # Allows manual trigger

jobs:
  check-and-update:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Ensures full history for branch checks

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: pip install requests

      - name: Run update script
        run: python .github/scripts/update_asdf_version.py
 
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          branch: feature/dependencies-version-check/update-asdf-to-latest
          base: main
          commit-message: "chore(deps): :arrow_up: update ASDF to latest version" 
          title: ":arrow_up: [asdf] Automated dependency update"
          body: |
            This is an automated update PR created by our dependency update bot. It scans for new releases of ASDF and updates the version accordingly.

            ðŸ”„ Changes in this PR:
              * Updated `ASDF_VERSION` to the latest release.
              * Adjusted `ASDF_MAJOR_VERSION`, `ASDF_MINOR_VERSION`, and `ASDF_PATCH_VERSION` based on the new version.

            ðŸ›  How this works:
              * The bot runs on a scheduled workflow to check for new ASDF releases.
              * If a new version is found, it updates the configuration file and creates this PR.
              * This ensures we always stay up to date with the latest improvements and security patches.

            ðŸ“Œ Next Steps:
              * Review the changes.
              * Merge if everything looks good! âœ…

            Releases details: [asdf releases](https://github.com/asdf-vm/asdf/releases)

            - [ ] Open this PR for review to trigger other workflows [see limitations](https://github.com/peter-evans/create-pull-request/blob/main/docs/concepts-guidelines.md#triggering-further-workflow-runs)

            âš¡ This PR was auto-generated by our dependency update workflow. ðŸš€
          labels: |
            dependencies
            automated
          delete-branch: false
          draft: true # allows PR to run other workflows when "Ready for review"
